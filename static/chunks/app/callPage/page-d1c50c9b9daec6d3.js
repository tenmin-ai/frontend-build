(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[426],{9064:function(e,t,n){Promise.resolve().then(n.bind(n,5483))},5483:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(7437),l=n(2265),c=n(4031),s=n(3061),i=n(7776),a=n(1980),u=n(6463),o=n(6596);function f(e){let{children:t}=e,n=(0,s.useIsClient)(),{token:l,saveToken:f,backend_url:d}=(0,a.E)(),h=(0,u.useSearchParams)(),x=o.r.find(e=>e.id==h.get("id"));return x?n?(0,r.jsx)(c.eA,{url:d+"/".concat(x.id)+"?token=".concat(l),label:"call",toast:i.A,autoconnect:!0,wsAuth:!0,children:t}):(0,r.jsx)("div",{children:"Loading.."}):(0,r.jsx)("div",{children:"Invalid tutor"})}var d=n(6920),h=n(5079);function x(){let e=(0,c.MV)("AUDIO_CALL",{isSpeaking:!1,status:"BACKEND_DISCONNECTED",transcriptFull:"",transcriptPartial:""}),t=(0,u.useRouter)(),n=(0,u.useSearchParams)(),s=o.r.find(e=>e.id==n.get("id"));console.log(n);let{startSpeaker:i,isPlaying:a}=function(e){let t=(0,l.useContext)(c.Dm),n=(0,l.useRef)(null),r=(0,l.useRef)([]),s=(0,l.useRef)(0),i=(0,l.useRef)(null),[a,u]=(0,l.useState)(!1),o=()=>{if(i.current&&(clearTimeout(i.current),i.current=null),0===r.current.length)return;let e=1,t=r.current.slice(0,2);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(2*t.length)}r.current.slice(2).forEach(e=>{e.stop()}),r.current=t},f=async e=>{let{i:t,data:l}=e;if(null===n.current){console.error("AudioContext not initialized!");return}0==t&&(r.current.length>0&&o(),s.current=n.current.currentTime);let c=n.current.createBufferSource();c.connect(n.current.destination),c.start(s.current+.1*t+0),r.current.push(c),1==r.current.length&&(i.current=setTimeout(()=>{u(!0),i.current=null},0)),c.onended=()=>{r.current.length>0&&r.current.shift(),0===r.current.length&&u(!1)};let a=await new Response(l).arrayBuffer(),f=new Int16Array(a),d=n.current.createBuffer(1,a.byteLength/2,24e3),h=d.getChannelData(0);for(let e=0;e<f.length;e++)h[e]=f[e]/32767;c.buffer=d};return(0,l.useEffect)(()=>{if(!t){console.error("No session found!");return}return t.registerEvent("TTS_CHUNK",f),t.registerEvent("TTS_INTERRUPT",()=>{console.log("TTS_INTERRUPT"),o()}),()=>{null==t||t.deregisterEvent("TTS_CHUNK"),null==t||t.deregisterEvent("TTS_INTERRUPT")}},[t]),(0,l.useEffect)(()=>{e.sendAction({type:a?"TTS_PLAYBACK_STARTED":"TTS_PLAYBACK_FINISHED"})},[a]),{isPlaying:a,startSpeaker:()=>{null===n.current&&(n.current=new(window.AudioContext||window.webkitAudioContext))}}}(e),{activated:f,setActivation:x}=function(e){let[t,n]=(0,l.useState)(null),r=(0,l.useRef)(null),[c,s]=(0,l.useState)(!1);(0,l.useEffect)(()=>{c?i():t&&a()},[c]);let i=async()=>{try{console.log(navigator.mediaDevices);let t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0}});r.current=t;let l=new MediaRecorder(t);n(l),await l.start(500),l.ondataavailable=t=>{e.sendBinary({type:"STREAM_MIC"},t.data)}}catch(e){console.error("Error accessing microphone:",e)}},a=()=>{t&&r.current&&(t.stop(),r.current.getTracks().forEach(e=>e.stop()),t.onstop=()=>{})};return{activated:c,setActivation:s}}(e);return(0,r.jsxs)("div",{className:"flex flex-col justify-between h-full items-center",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center w-full",children:[(0,r.jsxs)("div",{className:"flex w-full justify-between items-center",children:[(0,r.jsx)("button",{className:"text-white font-bold text-xl self-start ml-10 ",onClick:()=>{t.back()},children:(0,r.jsx)(d.G,{icon:h.A35})}),(0,r.jsx)("button",{className:"text-transparent font-bold text-xl self-start mr-10",children:(0,r.jsx)(d.G,{icon:h.A35})})]}),(0,r.jsx)("img",{src:null==s?void 0:s.imageSrc,alt:"",className:"w-24 mt-10"}),(0,r.jsxs)("p",{className:"pt-4 font-semibold text-white text-xl ",children:[null==s?void 0:s.name," ",(0,r.jsx)("span",{className:"",children:null==s?void 0:s.flag})]})]}),(0,r.jsxs)("div",{className:"flex gap-14 text-xl",children:[(0,r.jsx)("button",{className:"text-white text-2xl",children:(0,r.jsx)(d.G,{icon:h.UFh})}),"CONNECTED"!==e.status?(0,r.jsx)("button",{className:" bg-green-600 text-white font-bold w-16 h-16 rounded-full flex items-center justify-center",onClick:()=>{e.sendAction({type:"START_CALL"}),i(),x(!0)},children:(0,r.jsx)(d.G,{icon:h.j1w})}):(0,r.jsx)("button",{className:"bg-[#FD3A31] text-white font-bold w-16 h-16 rounded-full flex items-center justify-center",onClick:()=>{e.sendAction({type:"STOP_CALL"}),x(!1)},children:(0,r.jsx)(d.G,{icon:h.j1w,className:"rotate-[135deg]"})}),(0,r.jsx)("button",{className:"text-white text-2xl",onClick:()=>{e.sendAction({type:"SAY",text:"Hello! How are you doing today?"}),i()},children:(0,r.jsx)(d.G,{icon:h.X8G})})]})]})}function g(){return(0,r.jsx)(f,{children:(0,r.jsx)("main",{className:"bg-[#2A2A2A] h-screen py-16",children:(0,r.jsx)(x,{})})})}},1980:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return u},E:function(){return o}});var r=n(7437),l=n(2265),c=n(6463),s=n(6565),i=n(3061);let a=(0,l.createContext)(void 0),u=e=>{let{children:t}=e,n=(0,i.useIsClient)(),[u,o]=(0,s._)("token",void 0),f=(0,c.useRouter)();return((0,l.useEffect)(()=>{u||f.push("/login")},[u,f]),n)?(0,r.jsx)(a.Provider,{value:{token:u,saveToken:o,backend_url:"ws://localhost:6969/ws"},children:t}):(0,r.jsx)("div",{children:"Loading.."})},o=()=>{let e=(0,l.useContext)(a);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}},6596:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});let r=[{name:"Not Garry",flag:"\uD83C\uDDFA\uD83C\uDDF8",description:"English Teacher in San Francisco - Casual practice",buttonText:"Jump on a call",imageSrc:"/notgarry.png",profileLink:"/callPage",id:"666f2e3726983f077ca3f32c"},{name:"Mina",flag:"\uD83C\uDDE6\uD83C\uDDFA",description:"Passionate undergraduate student - Casual practice",buttonText:"Jump on a call",imageSrc:"/mina.png",profileLink:"/callPage",id:"666f2fa40d9f2172928b24e6"},{name:"Damian",flag:"\uD83C\uDDEC\uD83C\uDDE7",description:"English Teacher in Germany - Casual practice",buttonText:"Jump on a call",imageSrc:"/damian.png",profileLink:"/callPage",id:"666f304c0d9f2172928b24e8"}]},6565:function(e,t,n){"use strict";n.d(t,{_:function(){return l}});var r=n(2265);function l(e,t){let n=(0,r.useRef)(!1),[l,c]=(0,r.useState)(t);return(0,r.useEffect)(()=>{try{let t=window.localStorage.getItem(e);t&&c(JSON.parse(t))}catch(e){console.log(e)}return()=>{n.current=!1}},[e]),(0,r.useEffect)(()=>{n.current?window.localStorage.setItem(e,JSON.stringify(l)):n.current=!0},[e,l]),console.log("local storage",l),[l,c]}}},function(e){e.O(0,[676,168,307,31,971,23,744],function(){return e(e.s=9064)}),_N_E=e.O()}]);