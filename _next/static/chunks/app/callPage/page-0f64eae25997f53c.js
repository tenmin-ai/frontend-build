(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[426],{496:function(e,t,n){Promise.resolve().then(n.bind(n,5483))},5483:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(7437),l=n(2265),i=n(4031),a=n(3061),s=n(7776),c=n(1980),u=n(6463),o=n(6596);function d(e){let{children:t}=e,n=(0,a.useIsClient)(),{token:l,saveToken:d,backend_url:f}=(0,c.E)(),h=(0,u.useSearchParams)(),x=o.r.find(e=>e.id==h.get("id"));return x?n?(console.log("token",l),(0,r.jsx)(i.eA,{url:f+"/".concat(x.id)+"?token=".concat(l),label:"call",toast:s.A,autoconnect:!0,wsAuth:!0,children:t})):(0,r.jsx)("div",{children:"Loading.."}):(0,r.jsx)("div",{children:"Invalid tutor"})}var f=n(6920),h=n(5079);function x(){let e=(0,i.MV)("AUDIO_CALL",{isSpeaking:!1,status:"BACKEND_DISCONNECTED",transcriptFull:"",transcriptPartial:""}),t=(0,u.useRouter)(),n=(0,u.useSearchParams)(),a=o.r.find(e=>e.id==n.get("id"));console.log(n);let{startSpeaker:s,isPlaying:c}=function(e){let t=(0,l.useContext)(i.Dm),n=(0,l.useRef)(null),r=(0,l.useRef)([]),a=(0,l.useRef)(0),s=(0,l.useRef)(null),[c,u]=(0,l.useState)(!1),o=()=>{if(s.current&&(clearTimeout(s.current),s.current=null),0===r.current.length)return;let e=1,t=r.current.slice(0,2);for(let n of t)if(n&&n.buffer){let t=n.buffer.getChannelData(0);for(let n=0;n<t.length;n++)t[n]=t[n]*e,e-=1/(2*t.length)}r.current.slice(2).forEach(e=>{e.stop()}),r.current=t},d=async e=>{let{i:t,data:l}=e;if(null===n.current){console.error("AudioContext not initialized!");return}0==t&&(r.current.length>0&&o(),a.current=n.current.currentTime);let i=n.current.createBufferSource();i.connect(n.current.destination),i.start(a.current+.1*t+0),r.current.push(i),1==r.current.length&&(s.current=setTimeout(()=>{u(!0),s.current=null},0)),i.onended=()=>{r.current.length>0&&r.current.shift(),0===r.current.length&&u(!1)};let c=await new Response(l).arrayBuffer(),d=new Int16Array(c),f=n.current.createBuffer(1,c.byteLength/2,24e3),h=f.getChannelData(0);for(let e=0;e<d.length;e++)h[e]=d[e]/32767;i.buffer=f};return(0,l.useEffect)(()=>{if(!t){console.error("No session found!");return}return t.registerEvent("TTS_CHUNK",d),t.registerEvent("TTS_INTERRUPT",()=>{console.log("TTS_INTERRUPT"),o()}),()=>{null==t||t.deregisterEvent("TTS_CHUNK"),null==t||t.deregisterEvent("TTS_INTERRUPT")}},[t]),(0,l.useEffect)(()=>{e.sendAction({type:c?"TTS_PLAYBACK_STARTED":"TTS_PLAYBACK_FINISHED"})},[c]),{isPlaying:c,startSpeaker:()=>{null===n.current&&(n.current=new(window.AudioContext||window.webkitAudioContext))}}}(e),{activated:d,setActivation:x}=function(e){let[t,n]=(0,l.useState)(null),r=(0,l.useRef)(null),[i,a]=(0,l.useState)(!1);(0,l.useEffect)(()=>{i?s():t&&c()},[i]);let s=async()=>{try{console.log(navigator.mediaDevices);let t=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0}});r.current=t;let l=new MediaRecorder(t);n(l),await l.start(500),l.ondataavailable=t=>{e.sendBinary({type:"STREAM_MIC"},t.data)}}catch(e){console.error("Error accessing microphone:",e)}},c=()=>{t&&r.current&&(t.stop(),r.current.getTracks().forEach(e=>e.stop()),t.onstop=()=>{})};return{activated:i,setActivation:a}}(e);return(0,r.jsxs)("div",{className:"flex flex-col justify-between h-full items-center",children:[(0,r.jsxs)("div",{className:"flex flex-col items-center w-full",children:[(0,r.jsxs)("div",{className:"flex w-full justify-between items-center",children:[(0,r.jsx)("button",{className:"text-white font-bold text-xl self-start ml-10 ",onClick:()=>{t.back()},children:(0,r.jsx)(f.G,{icon:h.A35})}),(0,r.jsx)("button",{className:"text-transparent font-bold text-xl self-start mr-10",children:(0,r.jsx)(f.G,{icon:h.A35})})]}),(0,r.jsx)("img",{src:null==a?void 0:a.imageSrc,alt:"",className:"w-24 mt-10"}),(0,r.jsxs)("p",{className:"pt-4 font-semibold text-white text-xl ",children:[null==a?void 0:a.name," ",(0,r.jsx)("span",{className:"",children:null==a?void 0:a.flag})]})]}),(0,r.jsxs)("div",{className:"flex gap-14 text-xl",children:[(0,r.jsx)("button",{className:"text-white text-2xl",children:(0,r.jsx)(f.G,{icon:h.UFh})}),"CONNECTED"!==e.status?(0,r.jsx)("button",{className:" bg-green-600 text-white font-bold w-16 h-16 rounded-full flex items-center justify-center",onClick:()=>{e.sendAction({type:"START_CALL"}),s(),x(!0)},children:(0,r.jsx)(f.G,{icon:h.j1w})}):(0,r.jsx)("button",{className:"bg-[#FD3A31] text-white font-bold w-16 h-16 rounded-full flex items-center justify-center",onClick:()=>{e.sendAction({type:"STOP_CALL"}),x(!1)},children:(0,r.jsx)(f.G,{icon:h.j1w,className:"rotate-[135deg]"})}),(0,r.jsx)("button",{className:"text-white text-2xl",onClick:()=>{e.sendAction({type:"SAY",text:"Hello! How are you doing today?"}),s()},children:(0,r.jsx)(f.G,{icon:h.X8G})})]})]})}function g(){return(0,r.jsx)(d,{children:(0,r.jsx)("main",{className:"bg-[#2A2A2A] h-screen py-16",children:(0,r.jsx)(x,{})})})}},1980:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return u},E:function(){return o}});var r=n(7437),l=n(2265),i=n(6463),a=n(750),s=n(3061);let c=(0,l.createContext)(void 0),u=e=>{let{children:t}=e,n=(0,s.useIsClient)(),[u,o]=(0,a._)("token","",{initializeWithValue:!1}),d=(0,i.useRouter)();return((0,l.useEffect)(()=>{u||d.push("/login")},[u,d]),n)?(0,r.jsx)(c.Provider,{value:{token:u,saveToken:o,backend_url:"wss://backend-us.tenmin.ai/ws"},children:t}):(0,r.jsx)("div",{children:"Loading.."})},o=()=>{let e=(0,l.useContext)(c);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}},6596:function(e,t,n){"use strict";n.d(t,{r:function(){return r}});let r=[{name:"Garry",flag:"\uD83C\uDDFA\uD83C\uDDF8",description:"English Teacher in San Francisco - Casual practice",buttonText:"Jump on a call",imageSrc:"/notgarry.png",profileLink:"/callPage",id:"666f2e3726983f077ca3f32c"},{name:"Paul",flag:"\uD83C\uDDE9\uD83C\uDDEA",description:"Graduate student in Germany - Casual practice",buttonText:"Jump on a call - [Coming Soon]",imageSrc:"/paul.png",profileLink:"/callPage",id:"66733e98c07e477f46211380"},{name:"Mina",flag:"\uD83C\uDDE6\uD83C\uDDFA",description:"Passionate undergraduate student - Casual practice",buttonText:"Jump on a call",imageSrc:"/mina.png",profileLink:"/callPage",id:"666f2fa40d9f2172928b24e6"},{name:"Damian",flag:"\uD83C\uDDEC\uD83C\uDDE7",description:"English Teacher in Germany - Casual practice",buttonText:"Jump on a call",imageSrc:"/damian.png",profileLink:"/callPage",id:"666f304c0d9f2172928b24e8"}]}},function(e){e.O(0,[676,772,920,307,31,971,23,744],function(){return e(e.s=496)}),_N_E=e.O()}]);